<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Погода</title>
</head>
<body>
    <h2>Узнать погоду</h2>
    <form method="post">
        {% csrf_token %}
        <input list="city-options" type="text" name="city" placeholder="Введите город" required
               value="{{ last_city }}" id="city-input">
        <datalist id="city-options"></datalist>
        <button type="submit">Показать</button>
    </form>

    {% if weather %}
        <h3>Погода в {{ weather.city }}</h3>
        <ul>
            <li>Температура: {{ weather.temperature }} °C</li>
            <li>Скорость ветра: {{ weather.windspeed }} км/ч</li>
            <li>Время измерения: {{ weather.time }}</li>
        </ul>
    {% elif error %}
        <p style="color:red;">{{ error }}</p>
    {% endif %}

    {% if history %}
        <h4>Ранее введённые города:</h4>
        <ul>
            {% for item in history %}
                <li>{{ item }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <form method="get" action="/">
        <button type="submit" name="clear" value="1">Очистить историю</button>
    </form>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const input = document.getElementById('city-input');
    const datalist = document.getElementById('city-options');

    fetch('/api/history')
        .then(response => response.json())
        .then(data => {
            datalist.innerHTML = '';  // очищаем старое
            data.history.forEach(city => {
                const option = document.createElement('option');
                option.value = city;
                datalist.appendChild(option);
            });
        })
        .catch(error => {
            console.error('Ошибка при получении истории городов:', error);
        });
});
</script>

</body>
</html>
